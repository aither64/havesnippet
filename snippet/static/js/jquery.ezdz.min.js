 /* ----------------------------------------------------------------------------
 // Ezdz [izy-dizy]
 // v0.4.0 - released 2013-10-22 14:08
 // Licensed under the MIT license.
 // https://github.com/jaysalvat/ezdz
 // ----------------------------------------------------------------------------
 // Copyright (C) 2013 Jay Salvat
 // http://jaysalvat.com/
 // ---------------------------------------------------------------------------*/

!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?a(require("jquery")):a(jQuery)}(function(a){var b={className:"",text:"Drop a file",previewImage:!0,value:null,classes:{main:"ezdz-dropzone",enter:"ezdz-enter",reject:"ezdz-reject",accept:"ezdz-accept",focus:"ezdz-focus"},validators:{maxSize:null,width:null,maxWidth:null,minWidth:null,height:null,maxHeight:null,minHeight:null},init:function(){},enter:function(){},leave:function(){},reject:function(){},accept:function(){},format:function(a){return a}};a.ezdz=function(c,d){this.settings=a.extend(!0,{},b,a.ezdz.defaults,d),this.$input=a(c);var e=this,f=e.settings,g=e.$input;if(g.is('input[type="file"]')&&a.ezdz.isBrowserCompatible()){var h=function(){var b,c,d;c=a('<div class="'+f.classes.main+'" />').on("dragover.ezdz",function(){a(this).addClass(f.classes.enter),a.isFunction(f.enter)&&f.enter.apply(this)}).on("dragleave.ezdz",function(){a(this).removeClass(f.classes.enter),a.isFunction(f.leaved)&&f.leaved.apply(this)}).addClass(f.className),g.wrap(c).before("<div>"+f.text+"</div>"),b=g.parent("."+f.classes.main),d=f.value||g.data("value"),d&&e.preview(d),a.isFunction(f.init)&&f.init.apply(g,[d]),g.on("focus.ezdz",function(){b.addClass(f.classes.focus)}).on("blur.ezdz",function(){b.removeClass(f.classes.focus)}).on("change.ezdz",function(){var c=this.files[0];if(c){var d=c.name.replace(/\\/g,"/").replace(/.*\//,""),e=c.name.split(".").pop(),h=f.format(d);c.extension=e;var i=g.attr("accept"),j=!1;if(valid=!0,errors={mimeType:!1,maxSize:!1,width:!1,minWidth:!1,maxWidth:!1,height:!1,minHeight:!1,maxHeight:!1},i){var k=i.split(/[,|]/);a.each(k,function(b,d){if(d=a.trim(d),c.type==d)return j=!0,!1;if(d.indexOf("/*")!==!1){var e=d.replace("/*",""),f=c.type.replace(/(\/.*)$/g,"");if(e===f)return j=!0,!1}}),j===!1&&(errors.mimeType=!0)}else j=!0;if(b.removeClass(f.classes.reject+" "+f.classes.accept),j!==!0)return g.val(""),b.addClass(f.classes.reject),a.isFunction(f.reject)&&f.reject.apply(g,[c,errors]),!1;var l=new FileReader(c);l.readAsDataURL(c),l.onload=function(d){var e,i=new Image;c.data=d.target.result,i.src=c.data,setTimeout(function(){e=i.width&&i.height,f.validators.maxSize&&c.size>f.validators.maxSize&&(valid=!1,errors.maxSize=!0),e&&(c.width=i.width,c.height=i.height,f.validators.width&&i.width!=f.validators.width&&(valid=!1,errors.width=!0),f.validators.maxWidth&&i.width>f.validators.maxWidth&&(valid=!1,errors.maxWidth=!0),f.validators.minWidth&&i.width<f.validators.minWidth&&(valid=!1,errors.minWidth=!0),f.validators.height&&i.height!=f.validators.height&&(valid=!1,errors.height=!0),f.validators.maxHeight&&i.height>f.validators.maxHeight&&(valid=!1,errors.maxHeight=!0),f.validators.minHeight&&i.height<f.validators.minHeight&&(valid=!1,errors.minHeight=!0)),valid===!0?(b.find("img").remove(),e&&f.previewImage===!0?b.find("div").html(a(i).fadeIn()):b.find("div").html("<span>"+h+"</span>"),b.addClass(f.classes.accept),a.isFunction(f.accept)&&f.accept.apply(g,[c])):(g.val(""),b.addClass(f.classes.reject),a.isFunction(f.reject)&&f.reject.apply(g,[c,errors]))},250)}}})};h()}},a.ezdz.prototype.preview=function(b,c){var d=this.settings,e=this.$input,f=e.parent("."+d.classes.main);basename=b.replace(/\\/g,"/").replace(/.*\//,""),formatted=d.format(basename);var g=new Image;g.src=b,g.onload=function(){f.find("div").html(a(g).fadeIn()),a.isFunction(c)&&c.apply(this)},g.onerror=function(){f.find("div").html("<span>"+formatted+"</span>"),a.isFunction(c)&&c.apply(this)},f.addClass(d.classes.accept)},a.ezdz.prototype.destroy=function(){var a=this.settings,b=this.$input;b.parent("."+a.classes.main).replaceWith(b),b.off("*.ezdz"),b.data("ezdz","")},a.ezdz.prototype.options=function(b){var c=this.settings;return b?(a.extend(!0,this.settings,b),void 0):c},a.ezdz.prototype.container=function(){var a=this.settings,b=this.$input;return b.parent("."+a.classes.main)},a.ezdz.isBrowserCompatible=function(){return!!(window.File&&window.FileList&&window.FileReader)},a.ezdz.defaults=b,a.fn.ezdz=function(b){var c=arguments,d=a(this).data("ezdz");return d?d[b]?d[b].apply(d,Array.prototype.slice.call(c,1)):(a.error("Ezdz error - Method "+b+" does not exist."),void 0):a(this).data("ezdz",new a.ezdz(this,b))}});